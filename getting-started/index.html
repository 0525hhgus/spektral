<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Daniele Grattarola">
  <link rel="canonical" href="https://spektral.graphneural.network/getting-started/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Getting started - Spektral</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../stylesheets/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Getting started";
    var mkdocs_page_input_path = "getting-started.md";
    var mkdocs_page_url = "/getting-started/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-125823175-1', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Spektral</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Getting started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#node-classification-on-citation-networks">Node classification on citation networks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-a-gnn">Creating a GNN</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#training-the-gnn">Training the GNN</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#evaluating-the-model">Evaluating the model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#go-create">Go create!</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data/">Data representation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Layers</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../layers/convolution/">Convolutional Layers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../layers/pooling/">Pooling Layers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../layers/base/">Base Layers</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Data</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../datasets/">Datasets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/data/">Data utils</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Utils</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/convolution/">Convolution</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/misc/">Miscellaneous</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/conversion/">Conversion</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../chem/">Chemistry</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Other</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Spektral</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>Getting started</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/danielegrattarola/spektral/edit/master/docs/sources/getting-started.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="getting-started">Getting started</h2>
<p>Spektral is designed according to the guiding principles of the Keras API to make things extremely simple for beginners while maintaining flexibility for experts and researchers.  </p>
<p>The most important modules of Spektral are <code>layers.convolutional</code> and <code>layers.pooling</code>, which offer a number of popular layers to start building graph neural networks (GNNs) right away.   <br />
Because Spektral is designed as an extension of Keras, you can plug any Spektral layer into an existing Keras <code>Model</code> without modifications. </p>
<h3 id="node-classification-on-citation-networks">Node classification on citation networks</h3>
<p>In this example, we will build a simple <a href="https://arxiv.org/abs/1609.02907">Graph Convolutional Network</a> for semi-supervised classification of nodes.</p>
<p>This is a simple but challenging task that consists of classifying text documents in a <strong>citation network</strong>. <br />
In this type of graph, each node represents a document and is associated to a binary bag-of-words attribute (1 if a given word appears in the text, 0 otherwise). 
If a document cites another, then there exist an undirected edge between the two corresponding nodes. 
Finally, each node has a class label that we want to predict. </p>
<p>This is a <strong>transductive</strong> learning setting, where we observe all of the nodes and edges at training time, but only a fraction of the labels. The goal is to learn to predict the missing labels.</p>
<p>The <code>datasets.citation</code> module of Spektral lets you download and load three popular citation datasets (Cora, Citeseer and Pubmed) in one line of code. For instance, loading the Cora dataset is as simple as: </p>
<pre><code class="python">from spektral.datasets import citation
A, X, y, train_mask, val_mask, test_mask = citation.load_data('cora')

N = A.shape[0]
F = X.shape[-1]
n_classes = y.shape[-1]
</code></pre>

<p>This will load the network's adjacency matrix <code>A</code> as a Scipy sparse matrix of shape <code>(N, N)</code>, the node features <code>X</code> of shape <code>(N, F)</code>, and the labels <code>y</code> of shape <code>(N, n_classes)</code>. The loader will also return some boolean masks to know which nodes belong to the training, validation and test sets (<code>train_mask, val_mask, test_mask</code>).</p>
<h3 id="creating-a-gnn">Creating a GNN</h3>
<p>To create a GCN, we will use the <code>GraphConv</code> layer and the functional API of Keras:</p>
<pre><code class="python">from spektral.layers import GraphConv
from tensorflow.keras.models import Model
from tensorflow.keras.layers import Input, Dropout
</code></pre>

<p>Building the model is no different than building any Keras model, but we will need to provide multiple inputs (<code>X</code> and <code>A</code>) to the <code>GraphConv</code> layers:</p>
<pre><code class="python">X_in = Input(shape=(F, ))
A_in = Input((N, ), sparse=True)

X_1 = GraphConv(16, 'relu')([X_in, A_in])
X_1 = Dropout(0.5)(X_1)
X_2 = GraphConv(n_classes, 'softmax')([X_1, A_in])

model = Model(inputs=[X_in, A_in], outputs=X_2)
</code></pre>

<p>And that's it. We just built our first GNN in Spektral and Keras. </p>
<p>Note how we used the familiar API of Keras to create the GCN layers, as well as the standard <code>Dropout</code> layer to regularize our model. All features of Keras are also supported by Spektral (including initializers, regularizers, etc.).</p>
<p>An important thing to notice at this point is how we defined the <code>Input</code> layers of our model. 
Because the "elements" of our dataset are the node themselves, we are telling Keras to consider each node as a separate sample so that the <code>batch</code> axis is implicitly defined as <code>None</code>.<br />
In other words, a sample of the node attributes will be a vector of shape <code>(F, )</code> and a sample of the adjacency matrix will be one row of shape <code>(N, )</code>. </p>
<p>Keep this detail in mind for later. </p>
<h3 id="training-the-gnn">Training the GNN</h3>
<p>When training GCN, we have to pre-process the adjacency matrix to 1) add self-loops and 2) scale the weights of a node's connections according to its degree.</p>
<p>Some layers in Spektral require a different type of pre-processing in order to work correctly, and some work out-of-the-box on the binary <code>A</code>. 
The pre-processing required by each layer is available as a static class method <code>preprocess()</code>.</p>
<p>In our example, the pre-processing required by GCN is: </p>
<pre><code class="python">A = GraphConv.preprocess(A).astype('f4')
</code></pre>

<p>And that's all! 
What's left now for us is to compile and train our model: </p>
<pre><code class="python">model.compile(optimizer='adam',
              loss='categorical_crossentropy',
              weighted_metrics=['acc'])
model.summary()
</code></pre>

<p>Note that we used the <code>weighted_metrics</code> argument instead of the usual <code>metrics</code>. This is due to the particular semi-supervised problem that we are dealing with, and has to do with the boolean masks that we loaded earlier (more on that later).</p>
<p>We can now train the model using the native <code>fit()</code> method of Keras:</p>
<pre><code class="python"># Prepare data
X = X.toarray()
A = A.astype('f4')
validation_data = ([X, A], y, val_mask)

# Train model
model.fit([X, A], y,
          sample_weight=train_mask,
          validation_data=validation_data,
          batch_size=N,
          shuffle=False)
</code></pre>

<p>There are a couple of things to note here.</p>
<p>We have set <code>batch_size=N</code> and <code>shuffle=False</code>. This is because the default behaviour of Keras is to split the data into batches of 32 and shuffle the samples at each epoch. 
However, shuffling the adjacency matrix along one axis and not the other means that row <code>i</code> will represent a different node than column <code>i</code>.<br />
At the same time, if we split the graph into batches we may end up in a situation where we need to use a node attribute that is not part of the batch. The only solution is to take all the node features at the same time, hence <code>batch_size=N</code>.</p>
<p>Finally, we used <code>train_mask</code> and <code>val_mask</code> as <code>sample_weight</code>. <br />
This means that, during training, the training nodes will have a weight of 1 and the validation nodes will have a weight of 0. Then, in validation, we will set the training nodes to have a weight of 0 and the validation nodes to have a weight of 1. </p>
<p>This is all that we need to do to differentiate between training and test data. See how the model takes as input the full <code>X</code>, <code>A</code>, and <code>y</code> for both training and valdation? The only thing that changes is the mask. This is also why we used the <code>weighted_metrics</code> keyword when compiling the model, so that our accuracy is calculated only on the correct nodes at each phase. </p>
<h3 id="evaluating-the-model">Evaluating the model</h3>
<p>Once again, evaluation is done in vanilla Keras. We just have to keep in mind the same considerations about batching that we did for training (note that in <code>model.evaluate()</code> by default <code>shuffle=False</code>): </p>
<pre><code class="python"># Evaluate model
eval_results = model.evaluate([X, A],
                              y,
                              sample_weight=test_mask,
                              batch_size=N)
print('Done.\n'
      'Test loss: {}\n'
      'Test accuracy: {}'.format(*eval_results))
</code></pre>

<h3 id="go-create">Go create!</h3>
<p>You are now ready to use Spektral to create your own models. </p>
<p>If you want to build a GNN for a specific task, chances are that everything you need is already part of Spektral. Check the <a href="https://github.com/danielegrattarola/spektral/tree/master/examples">examples</a> for some ideas and practical tips.</p>
<p>Remember to read the <a href="https://danielegrattarola.github.io/spektral/data/">data representation section</a> to learn different ways of representing a graph or batches of different graphs. </p>
<p>Make sure to check the documentation, and get in touch <a href="https://github.com/danielegrattarola/spektral">on Github</a> if you have a feature that you want to see implemented. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data/" class="btn btn-neutral float-right" title="Data representation">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/danielegrattarola/spektral/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../data/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../js/macros.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
