<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Daniele Grattarola">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Data representation - Spektral</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../stylesheets/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Data representation";
    var mkdocs_page_input_path = "data.md";
    var mkdocs_page_url = "/spektral/data/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-125823175-1', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Spektral</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting-started/">Getting started</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Data representation</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#representing-graphs">Representing graphs</a></li>
    

    <li class="toctree-l3"><a href="#modes">Modes</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#single-mode">Single mode</a></li>
        
            <li><a class="toctree-l4" href="#batch-mode">Batch mode</a></li>
        
            <li><a class="toctree-l4" href="#mixed-mode">Mixed mode</a></li>
        
            <li><a class="toctree-l4" href="#disjoint-mode">Disjoint mode</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#conversion-methods">Conversion methods</a></li>
    

    <li class="toctree-l3"><a href="#molecules">Molecules</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../examples/">Examples</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Layers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../layers/convolution/">Convolutional Layers</a>
                </li>
                <li class="">
                    
    <a class="" href="../layers/pooling/">Pooling Layers</a>
                </li>
                <li class="">
                    
    <a class="" href="../layers/base/">Base Layers</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Datasets</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../datasets/citation/">Citation</a>
                </li>
                <li class="">
                    
    <a class="" href="../datasets/delaunay/">Delaunay</a>
                </li>
                <li class="">
                    
    <a class="" href="../datasets/graphsage/">GraphSage</a>
                </li>
                <li class="">
                    
    <a class="" href="../datasets/qm9/">QM9</a>
                </li>
                <li class="">
                    
    <a class="" href="../datasets/mnist/">MNIST</a>
                </li>
                <li class="">
                    
    <a class="" href="../datasets/tud/">TU Dortmund</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Utils</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../utils/data/">Data</a>
                </li>
                <li class="">
                    
    <a class="" href="../utils/convolution/">Convolution</a>
                </li>
                <li class="">
                    
    <a class="" href="../utils/misc/">Miscellaneous</a>
                </li>
                <li class="">
                    
    <a class="" href="../utils/plotting/">Plotting</a>
                </li>
                <li class="">
                    
    <a class="" href="../utils/conversion/">Conversion</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chem/">Chemistry</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">About</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Spektral</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>Data representation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/danielegrattarola/spektral/edit/master/docs/sources/data.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="representing-graphs">Representing graphs</h2>
<p>Spektral uses a matrix-based representation for manipulating graphs and feeding them to neural networks. This approach is one of the most commonly used in the literature on graph neural networks, and it's perfect to perform parallel computations on GPU.</p>
<table>
<thead>
<tr>
<th align="left">WARNING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Support for edge attributes is not fully implemented in Spektral.</td>
</tr>
</tbody>
</table>
<p>A graph is generally represented by three matrices:</p>
<ul>
<li>
<script type="math/tex">A \in \mathbb{R}^{N \times N}</script>, a square adjacency matrix where <script type="math/tex">A_{ij} > 0</script> if there is a connection between nodes <script type="math/tex">i</script> and <script type="math/tex">j</script>, and <script type="math/tex">A_{ij} = 0</script> otherwise;</li>
<li>
<script type="math/tex">X \in \mathbb{R}^{N \times F}</script>, a matrix encoding node attributes, where each row represents the <script type="math/tex">F</script>-dimensional attribute vector of a node;</li>
<li>
<script type="math/tex">E \in \mathbb{R}^{N \times N \times S}</script>, a matrix encoding edge attributes, where each entry represents the <script type="math/tex">S</script>-dimensional attribute vector of an edge;</li>
</ul>
<p>Some frameworks (like the <a href="https://arxiv.org/abs/1806.01261">graph networks</a> proposed by Battaglia et al.) also include a feature vector describing the global state of the graph, but this is not supported by Spektral for now. </p>
<p>In code, and in this documentation, we use the following convention to refer to the formulation above:</p>
<ul>
<li><code>A</code> is the adjacency matrix, <code>N</code> is the number of nodes;</li>
<li><code>X</code> is the node attributes matrix, <code>F</code> is the size of the node attributes;</li>
<li><code>E</code> is the edge attributes matrix, <code>S</code> is the size of the edge attributes;</li>
</ul>
<p>See the table below for how these matrices are represented in Numpy. </p>
<h2 id="modes">Modes</h2>
<p>In Spektral, some functionalities are implemented to work on a single graph, while others consider batches of graphs. </p>
<p>To understand the difference between the two settings, consider the difference between classifying the nodes of a citation network, and classifying the chemical properties of molecules.<br />
For the citation network, we are interested in the individual nodes and the connections between them. Node and edge attributes are specific to each individual network, and we are usually not interested in training models that work on different networks. The nodes of themselves are our data.<br />
On the other hand, when working with molecules in a dataset, we are in a much more familiar setting. Each molecule is a sample of our dataset, and the atoms and bonds that make up the molecules are the constituent part of each data point (like pixels in images). In this case, we are interested in finding patterns that describe the properties of the molecules in general. </p>
<p>The two settings require us to do things that are conceptually similar, but that need some minor adjustments in how the data is processed by our graph neural networks. This is why Spektral makes these differences explicit.</p>
<p>In practice, we actually distinguish between three main <strong>modes</strong> of operation: </p>
<ul>
<li><strong>single</strong>, where we have a single graph, with fixed topology and attributes;</li>
<li><strong>batch</strong>, where we have a set of different graphs, each with its own topology and attributes;</li>
<li><strong>mixed</strong>, where we have a graph with fixed topology, but a set of different attributes (usually called <em>graph signals</em>); this can be seen as a particular case of the batch mode, but it is handled separately in Spektral to improve memory efficiency.</li>
</ul>
<p>We also have the <strong>disjoint</strong> mode, which is a simple trick to represent a batch of graphs in single mode. This requires an additional data structure to keep track of the graphs, and is explained in detail at the end of this section.</p>
<p>The difference between the three main modes can be easily seen in how <code>A</code>, <code>X</code>, and <code>E</code> have different shapes in each case:</p>
<table>
<thead>
<tr>
<th align="center">Mode</th>
<th align="center"><code>A.shape</code></th>
<th align="center"><code>X.shape</code></th>
<th align="center"><code>E.shape</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Single</td>
<td align="center"><code>(N, N)</code></td>
<td align="center"><code>(N, F)</code></td>
<td align="center"><code>(N, N, S)</code></td>
</tr>
<tr>
<td align="center">Batch</td>
<td align="center"><code>(batch, N, N)</code></td>
<td align="center"><code>(batch, N, F)</code></td>
<td align="center"><code>(batch, N, N, S)</code></td>
</tr>
<tr>
<td align="center">Mixed</td>
<td align="center"><code>(N, N)</code></td>
<td align="center"><code>(batch, N, F)</code></td>
<td align="center"><code>(batch, N, N, S)</code></td>
</tr>
</tbody>
</table>
<h3 id="single-mode">Single mode</h3>
<p>In <strong>single mode</strong> the data describes a single graph. Three very popular datasets in this setting are the citation networks, Cora, Citeseer, and Pubmed. To load a citation network, you can use the built-in loader:</p>
<pre><code class="py">In [1]: from spektral.datasets import citation
Using TensorFlow backend.

In [2]: A, X, _, _, _, _, _, _ = citation.load_data('cora')
Loading cora dataset

In [3]: A.shape
Out[3]: (2708, 2708)

In [4]: X.shape
Out[4]: (2708, 1433)
</code></pre>

<p>When training GNNs in single mode, we cannot batch and shuffle the data along the first axis, and the whole graph must be fed to the model at each step (see <a href="https://github.com/danielegrattarola/spektral/blob/master/examples/node_classification_gcn.py">the node classification example</a>).</p>
<h3 id="batch-mode">Batch mode</h3>
<p>In <strong>batch mode</strong>, the matrices will have a <code>batch</code> dimension first. There are several benchmark datasets with this structure, including the very popular <a href="https://ls11-www.cs.tu-dortmund.de/staff/morris/graphkerneldatasets">Benchmark Data Sets for Graph Kernels</a>. <br />
A batch mode dataset that can be loaded natively by Spektral is the QM9 chemical database of small molecules:</p>
<pre><code class="py">In [1]: from spektral.datasets import qm9
Using TensorFlow backend.

In [2]: A, X, E, _ = qm9.load_data()
Loading QM9 dataset.
Reading SDF
100%|█████████████████████| 133885/133885 [00:29&lt;00:00, 4579.22it/s]

In [3]: A.shape
Out[3]: (133885, 9, 9)

In [4]: X.shape
Out[4]: (133885, 9, 6)

In [5]: E.shape
Out[5]: (133885, 9, 9, 1)
</code></pre>

<p>Note that the graphs in QM9 have variable order (i.e., different <code>N</code> for each graph), and that by default <code>load_data()</code> pads them with zeros in order to store the data in Numpy arrays.<br />
See the <a href="https://danielegrattarola.github.io/spektral/data/#disjoint-mode">disjoint mode</a> section for an alternative to zero-padding. </p>
<h3 id="mixed-mode">Mixed mode</h3>
<p>In <strong>mixed mode</strong> we consider a single adjacency matrix, and different node and edge attributes matrices. An example of a mixed mode dataset is the MNIST random grid proposed by <a href="https://arxiv.org/abs/1606.09375">Defferrard et al.</a>:</p>
<pre><code class="py">In [1]: from spektral.datasets import mnist
Using TensorFlow backend.

In [2]: X, _, _, _, _, _, A = mnist.load_data()

In [3]: A.shape
Out[3]: (784, 784)

In [4]: X.shape
Out[4]: (50000, 784, 1)
</code></pre>

<h3 id="disjoint-mode">Disjoint mode</h3>
<p><img alt="" src="https://danielegrattarola.github.io/spektral/img/disjoint.svg" /></p>
<p>When dealing with graphs with a variable number of nodes, representing a group of graphs in batch mode requires padding <code>A</code>, <code>X</code>, and <code>E</code> to a fixed dimension.  <br />
In order to avoid this issue, a common approach is to represent a batch of graphs as a single disjoint union, and then using this "supergraph" in single mode.</p>
<p>The disjoint union of a batch of graphs is a graph where: </p>
<ol>
<li><code>A</code> is a block diagonal matrix, constructed from the adjacency matrices of the batch;</li>
<li><code>X</code> is obtained by stacking the node attributes of the batch;</li>
<li><code>E</code> is a block diagonal tensor of rank 3, obtained from the edge attributes;</li>
</ol>
<p>In order to keep track of different graphs in the disjoint union, we use an additional array of integers <code>I</code>, that maps each node to a graph with a progressive, zero-based indexing.</p>
<p>Utilities for creating the disjoint union of a list of graphs are provided in <code>spektral.utils.data</code>:</p>
<pre><code class="py">In [1]: from spektral.utils.data import Batch                                                               
Using TensorFlow backend.

In [2]: A_list = [np.ones((2, 2))] * 3                                                                

In [3]: X_list = [np.random.normal(size=(2, 4))] * 3                                                  

In [4]: b = Batch(A_list, X_list)                                                                     

In [5]: b.A.todense()                                                                                 
Out[5]: 
matrix([[1., 1., 0., 0., 0., 0.],
        [1., 1., 0., 0., 0., 0.],
        [0., 0., 1., 1., 0., 0.],
        [0., 0., 1., 1., 0., 0.],
        [0., 0., 0., 0., 1., 1.],
        [0., 0., 0., 0., 1., 1.]])

In [6]: b.X                                                                                           
Out[6]: 
array([[-0.85196709, -1.66795384, -1.14046868,  0.4735151 ],
       [ 0.14221143, -0.76473164, -1.05635638,  1.45961459],
       [-0.85196709, -1.66795384, -1.14046868,  0.4735151 ],
       [ 0.14221143, -0.76473164, -1.05635638,  1.45961459],
       [-0.85196709, -1.66795384, -1.14046868,  0.4735151 ],
       [ 0.14221143, -0.76473164, -1.05635638,  1.45961459]])

In [7]: b.I                                                                                           
Out[7]: array([0, 0, 1, 1, 2, 2])

In [8]: b.get('AXI')                                                                                  
Out[8]: 
(&lt;6x6 sparse matrix of type '&lt;class 'numpy.float64'&gt;'
  with 12 stored elements in COOrdinate format&gt;,
 array([[-0.85196709, -1.66795384, -1.14046868,  0.4735151 ],
        [ 0.14221143, -0.76473164, -1.05635638,  1.45961459],
        [-0.85196709, -1.66795384, -1.14046868,  0.4735151 ],
        [ 0.14221143, -0.76473164, -1.05635638,  1.45961459],
        [-0.85196709, -1.66795384, -1.14046868,  0.4735151 ],
        [ 0.14221143, -0.76473164, -1.05635638,  1.45961459]]),
 array([0, 0, 1, 1, 2, 2]))
</code></pre>

<p>Convolutional layers that work in single mode will work for this type of data representation, without any modification.<br />
Pooling layers, on the other hand, require the batch indices vector in order to know which nodes to pool together. </p>
<p>Global pooling layers will consume <code>I</code> and reduce the graphs to single vectors. Standard pooling layers will return a reduced version of <code>I</code> along with the reduced graphs. </p>
<hr />
<h2 id="conversion-methods">Conversion methods</h2>
<p>To provide better compatibility with other libraries, Spektral has methods to convert graphs between the matrix representation (<code>'numpy'</code>) and other formats. </p>
<p>The <code>'networkx'</code> format represents graphs using the Networkx library, which can then be used to <a href="https://networkx.github.io/documentation/networkx-1.10/reference/convert.html">convert the graphs</a> to other formats like <code>.dot</code> and edge lists. 
Conversion utils between <code>'numpy'</code> and <code>'networkx'</code> are provided in <code>spektral.utils.conversion</code>.</p>
<hr />
<h2 id="molecules">Molecules</h2>
<p>When working with molecules, some specific formats can be used to represent the graphs. </p>
<p>The <code>'sdf'</code> format is an internal representation format used to store an SDF file as a dictionary. A molecule in <code>'sdf'</code> format will look like this: </p>
<pre><code class="py">{'atoms': [{'atomic_num': 7,
           'charge': 0,
           'coords': array([-0.0299,  1.2183,  0.2994]),
           'index': 0,
           'info': array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
          'iso': 0},
          ...,
          {'atomic_num': 1,
           'charge': 0,
           'coords': array([ 0.6896, -2.3002, -0.1042]),
           'index': 14,
           'info': array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
           'iso': 0}],
'bonds': [{'end_atom': 13,
           'info': array([0, 0, 0]),
           'start_atom': 4,
           'stereo': 0,
           'type': 1},
          ...,
          {'end_atom': 8,
           'info': array([0, 0, 0]),
           'start_atom': 7,
           'stereo': 0,
           'type': 3}],
'comment': '',
'data': [''],
'details': '-OEChem-03231823253D',
'n_atoms': 15,
'n_bonds': 15,
'name': 'gdb_54964',
'properties': []}
</code></pre>

<p>The <code>'rdkit'</code> format uses the <a href="http://www.rdkit.org/docs/index.html">RDKit</a> library to represent molecules, and offers several methods to manipulate molecules with a chemistry-oriented approach.</p>
<p>The <code>'smiles'</code> format represents molecules as strings, and can be used as a space-efficient way to store molecules or perform quick checks on a dataset (e.g., counting the unique number of molecules in a dataset is quicker if all molecules are converted to SMILES first).</p>
<p>The <code>spektral.chem</code> and <code>spektral.utils</code> modules offer conversion methods between all of these formats, although some conversions may need more than one step (e.g., <code>'sdf'</code> to <code>'networkx'</code> to <code>'numpy'</code> to <code>'smiles'</code>). </p>
<table>
<thead>
<tr>
<th align="left">NOTE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Support for direct conversion between all formats will be added eventually.</td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../examples/" class="btn btn-neutral float-right" title="Examples">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../getting-started/" class="btn btn-neutral" title="Getting started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/danielegrattarola/spektral/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../getting-started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../examples/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../js/macros.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
